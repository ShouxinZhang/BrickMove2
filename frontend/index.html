<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
          onload="renderMathInElement(document.body, {delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false}]});"></script>
</head>
<body>
  <div id="app">
    <div class="top-controls">
      <button id="tocToggle" class="toc-toggle" type="button">目录</button>
      <div class="api-summary">
        <span class="api-summary-item">总 API: <strong id="apiTotalSummary">0</strong></span>
        <span class="api-summary-item">唯一: <strong id="apiUniqueSummary">0</strong></span>
        <button id="apiListToggle" class="api-list-toggle" type="button">查看 API 列表</button>
      </div>
    </div>
    <header>
      <div class="actions-import">
        <input type="file" id="fileInput" accept=".json,.md,.csv" />
        <label for="fileInput" class="file-label">选择 JSON/Markdown 文件</label>
        <button id="loadJsonBtn" class="load-json-btn">从文本加载</button>
        <button id="saveBtn">下载JSON</button>
      </div>
      <div class="actions-export">
        <input type="file" id="csvUploadInput" accept=".csv" hidden />
        <button id="csvUploadBtn" class="upload-csv-btn" type="button">保存到目录</button>
        <button id="exportCsvBtn" class="export-csv-btn">导出CSV</button>
        <button id="exportMdBtn" class="export-md-btn">导出Markdown</button>
        <button id="saveAllBtn" class="upload-csv-btn" type="button">保存</button>
        <button id="openHistoryBtn" class="upload-csv-btn" type="button">历史</button>
        <button id="settingsBtn" class="settings-btn" type="button">设置</button>
      </div>
    </header>
    <main>
      <aside id="tocPanel" class="toc-panel">
        <div class="toc-header">
          <span class="toc-title">目录</span>
        </div>
        <div class="toc-body">
          <ul id="tocSteps" class="toc-step-list"></ul>
        </div>
      </aside>
      <section class="editor">
        <h2>Write (结构化输入)</h2>
        <div class="form-section">
          <label>定理 ID</label>
          <input type="text" id="theoremTitle" placeholder="定理编号，如 100" />
        </div>
        <div class="form-section">
          <label>定理陈述 (MathJax)</label>
          <textarea id="theoremStatement" rows="3" placeholder="用 $...$ 和 $$...$$ 写数学公式"></textarea>
        </div>
        <div class="form-section">
          <label>全局符号 (逗号分隔，供所有部分继承)</label>
          <input type="text" id="theoremSymbols" placeholder="如 x:R, y:R, f:R→R" />
        </div>
        <div class="form-section">
          <label>证明步骤</label>
          <div id="stepsContainer"></div>
        </div>
        <div class="form-section api-stats">
          <div class="stats-header">
            <label>API 统计</label>
          </div>
          <div id="apiStatsDisplay" class="api-stats-display">
            <div class="stat-item">
              <span class="stat-label">总API数量:</span>
              <span class="stat-value" id="totalApis">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">唯一API数量:</span>
              <span class="stat-value" id="uniqueApis">0</span>
            </div>
          </div>
          <div id="apiList" class="api-list-detail"></div>
        </div>
      </section>
      <section class="preview">
        <h2>Preview</h2>
        <div id="preview"></div>
      </section>
    </main>
    <footer>
      <small>Lean4</small>
    </footer>
  </div>
  <div id="apiModal" class="api-modal hidden" role="dialog" aria-modal="false" aria-labelledby="apiModalTitle" tabindex="-1">
    <div class="api-modal-content">
      <div class="api-modal-header">
        <h3 id="apiModalTitle">唯一 API 列表</h3>
        <button id="apiModalClose" class="api-modal-close" type="button" aria-label="关闭">×</button>
      </div>
      <div class="api-modal-body" id="apiModalBody"></div>
    </div>
  </div>
  <dialog id="historyDialog" class="settings-dialog">
    <form class="settings-form" method="dialog">
      <h3 class="settings-title">历史文件</h3>
      <div id="historyList" style="max-height: 50vh; overflow: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
      </div>
      <div class="settings-actions">
        <button type="submit" class="settings-cancel">关闭</button>
      </div>
    </form>
  </dialog>
  <dialog id="settingsDialog" class="settings-dialog">
    <form id="settingsForm" class="settings-form">
      <h3 class="settings-title">导出设置</h3>
      <label class="settings-field">
        <span>CSV 保存目录</span>
        <input type="text" id="settingsCsvDirInput" placeholder="留空使用默认 csv_save" />
        <small>可填写绝对路径，或相对于工作区的路径。</small>
      </label>
      <div class="settings-actions">
        <button type="button" id="settingsCancelBtn" class="settings-cancel">取消</button>
        <button type="submit" class="settings-save">保存</button>
      </div>
    </form>
  </dialog>
  <script type="module" src="main.js"></script>
</body>
</html>
